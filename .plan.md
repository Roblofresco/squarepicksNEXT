# Add Time Remaining Display & Watch Link Hover Feature

## Overview

Enhance the game card and game page to display `timeRemaining` for live games and add a hover feature to the broadcast provider text that could link to watching the game.

## Current State Analysis

### ESPN API Data Available
✅ **`timeRemaining`** - Already stored in Firestore (line 234 in `functions/index.js`)
- Format: String like "12:45", "0:03", etc.
- Updated during live games via `mapStatusFields()` function
- Extracted from `comp?.status?.displayClock`

❌ **Watch/Streaming URLs** - NOT available in ESPN API
- ESPN API doesn't provide direct streaming links
- We can still enhance the broadcast provider display with hover effects
- Future consideration: Manual entry or integration with other APIs

### Current Display Locations

**1. Game Card (Lobby) - `src/components/lobby/GamesList.tsx`**
- Lines 149-159: Live game shows quarter (e.g., "1st Qtr")
- Line 168-172: Broadcast provider shown below (e.g., "ESPN", "FOX")
- **Missing**: Time remaining not displayed

**2. Game Page - `src/app/game/[gameId]/page.tsx`**
- Lines 853-864: Live view shows quarter above score
- Line 886-890: Broadcast provider in small text below score
- **Missing**: Time remaining not displayed

## Design Requirements

### Time Remaining Display

**Visual Style**: "Indented container" look
- Container should appear recessed/inset from its parent
- Use subtle border, shadow, and background contrast
- Place near the quarter indicator for context

**Placement Options**:

#### Option A: Game Card (Recommended)
```
┌─────────────┐
│    [LOGO]   │
│     DEN     │
└─────────────┘
    21 - 17
  ┌─────────┐
  │ 1st Qtr │  ← Quarter
  │  12:45  │  ← Time Remaining (indented style)
  └─────────┘
      FOX
```

#### Option B: Game Page
```
        1st Qtr         ← Quarter (current)
      ┌─────────┐
      │  12:45  │       ← Time Remaining (indented below)
      └─────────┘
     21 - 17            ← Score
```

**Styling**: Indented/Inset Effect
```css
- border: 1px solid rgba(255,255,255,0.1)
- background: rgba(0,0,0,0.3) or bg-slate-950/40
- box-shadow: inset 0 2px 4px rgba(0,0,0,0.3)
- padding: 2px 6px
- rounded corners (rounded-md)
- text: tabular-nums for consistent width
- font-size: slightly smaller than quarter text
```

### Watch Link Hover Feature

**Current**: Broadcast provider is plain text (e.g., "ESPN", "FOX")

**Enhanced**:
- Add "Watch on " prefix (e.g., "Watch on ESPN")
- Make text interactive with hover state
- Show cursor pointer
- Hover effects:
  - Color change (accent-1 blue)
  - Subtle underline
  - Icon indicator (optional: external link icon)

**Future**: When URLs are available
- Could open in new tab
- Show tooltip with streaming service info
- Link to official broadcaster streaming page

## Implementation Plan

### 1. Update Game Card (`src/components/lobby/GamesList.tsx`)

**Location**: After line 159 (inside the live quarter display section)

**Changes**:
```typescript
{isLive ? (
  <div className="flex flex-col items-center gap-1">
    <span>{(() => {
      const period = game.period || (game.quarter as any);
      // ... existing quarter logic ...
    })()}</span>
    
    {/* NEW: Time Remaining - Indented Container */}
    {(game.timeRemaining || (game as any).time_remaining) && (
      <div className="px-2 py-0.5 rounded-md border border-white/10 bg-slate-950/40 shadow-[inset_0_2px_4px_rgba(0,0,0,0.3)]">
        <span className="text-[9px] sm:text-[10px] text-slate-300 font-mono tabular-nums">
          {game.timeRemaining || (game as any).time_remaining}
        </span>
      </div>
    )}
  </div>
) : (
  // ... existing upcoming time/date ...
)}
```

**Update Broadcast Provider Display** (line 168-172):
```typescript
{(game.broadcastProvider || game.broadcast_provider) && (
  <div 
    className="text-[0.55rem] sm:text-[0.65rem] text-gray-400 hover:text-accent-1 font-medium truncate w-full transition-colors cursor-pointer group"
    title="Watch this game"
  >
    Watch on <span className="group-hover:underline">{game.broadcastProvider || game.broadcast_provider}</span>
  </div>
)}
```

### 2. Update Game Page (`src/app/game/[gameId]/page.tsx`)

**Location**: After line 864 (after quarter display in live view)

**Changes**:
```typescript
{effectiveView === 'live' && (
  <>
    <div className="text-xs sm:text-sm text-red-400 animate-pulse font-semibold mb-0.5">
      {(() => {
        // ... existing quarter logic ...
      })()}
    </div>
    
    {/* NEW: Time Remaining - Indented Container */}
    {(gameDetails.timeRemaining || (gameDetails as any).time_remaining) && (
      <div className="mb-1 px-3 py-1 rounded-md border border-white/10 bg-slate-950/40 shadow-[inset_0_2px_4px_rgba(0,0,0,0.3)]">
        <span className="text-[10px] sm:text-xs text-slate-300 font-mono tabular-nums">
          {gameDetails.timeRemaining || (gameDetails as any).time_remaining}
        </span>
      </div>
    )}
    
    <div className="text-2xl sm:text-3xl md:text-4xl font-bold text-white tabular-nums mb-1">
      {gameDetails.awayScore ?? gameDetails.away_score ?? 0} - {gameDetails.homeScore ?? gameDetails.home_score ?? 0}
    </div>
  </>
)}
```

**Update Broadcast Provider Display** (line 886-890):
```typescript
{(gameDetails.broadcastProvider || gameDetails.broadcast_provider) && (
  <div className="text-[10px] sm:text-xs text-slate-500 hover:text-accent-1 mt-1 transition-colors cursor-pointer group">
    <span className="group-hover:underline">
      Watch on {gameDetails.broadcastProvider || gameDetails.broadcast_provider}
    </span>
    {' • '}Week {gameDetails.week} • {gameDetails.sport}
  </div>
)}
```

### 3. Update TypeScript Interfaces (if needed)

**Files**: 
- `src/app/game/[gameId]/page.tsx` - `GameDetails` interface
- `src/lib/types.ts` (if exists) - `Game` type

**Add**:
```typescript
interface GameDetails {
  // ... existing fields ...
  timeRemaining?: string;
}
```

### 4. Verify Firestore Data Flow

✅ **Already implemented** in `functions/index.js`:
- Line 143: `const displayClock = comp?.status?.displayClock;`
- Line 161: `timeRemaining: String(displayClock || ""),`
- Line 234: Written to Firestore during game updates

**No changes needed** - data is already flowing correctly.

## Visual Mockups

### Game Card - Live State
```
┌──────────────────┐
│   [DEN LOGO]     │
│       DEN        │
└──────────────────┘
                     
     21 - 17         ← Score
                     
    ┌─────────┐
    │ 1st Qtr │      ← Quarter
    └─────────┘
    ┌─────────┐
    │  12:45  │      ← Time Remaining (indented)
    └─────────┘
                     
   Watch on FOX      ← Hover effect (blue + underline)
```

### Game Page - Live State
```
[LOGO]     1st Qtr      [LOGO]
 DEN     ┌─────────┐     KC
         │  12:45  │          ← Time Remaining (indented)
         └─────────┘
          21 - 17             ← Score
                     
  Watch on ESPN • Week 5 • NFL  ← Hover effect
```

## Color Palette

Using existing theme colors from `tailwind.config.js`:

**Indented Container**:
- Border: `border-white/10` or `border-slate-700/50`
- Background: `bg-slate-950/40` or `bg-black/30`
- Text: `text-slate-300` (neutral, readable)

**Hover State (Watch Link)**:
- Default: `text-gray-400` (game card) / `text-slate-500` (game page)
- Hover: `text-accent-1` (theme blue: #1BB0F2)
- Underline: `group-hover:underline`

## Testing Checklist

- [ ] Time remaining displays correctly on live game cards
- [ ] Time remaining displays correctly on live game page
- [ ] Indented container style looks good on mobile and desktop
- [ ] Time remaining updates in real-time during live games
- [ ] Broadcast provider hover effect works on game cards
- [ ] Broadcast provider hover effect works on game page
- [ ] Layout doesn't break when `timeRemaining` is empty/undefined
- [ ] Font is monospaced (tabular-nums) for consistent width
- [ ] Colors complement dark theme
- [ ] Responsive sizing works across breakpoints

## Future Enhancements

1. **Streaming URLs** (when available):
   - Add manual admin interface to input streaming URLs per broadcaster
   - Store in Firestore: `broadcasters` collection with `{ name, streamingUrl }`
   - Update game card/page to link to actual streaming services

2. **Smart Linking**:
   - ESPN → ESPN+ link
   - FOX → FOX Sports app/website
   - Network-specific routing

3. **Overtime Handling**:
   - Display "OT" instead of quarter when in overtime
   - Update period formatting logic

4. **Halftime Display**:
   - Show "Halftime" + time remaining until 2nd half
   - Different styling for halftime state

## Files to Modify

1. ✅ `src/components/lobby/GamesList.tsx` (lines 149-172)
2. ✅ `src/app/game/[gameId]/page.tsx` (lines 851-890)
3. ⚠️ Optional: Type definitions if TypeScript errors occur
4. ❌ No Cloud Functions changes needed (data already flows)

## Notes

- **ESPN API Limitation**: Direct streaming URLs are not provided by ESPN's public API
- **Workaround**: Enhanced UI/UX with hover effects, future manual URL mapping
- **Time Format**: ESPN provides various formats ("12:45", "0:03", "15:00")
- **Edge Cases**: Handle empty/undefined `timeRemaining` gracefully
- **Accessibility**: Ensure hover states work well, consider keyboard navigation

